menu "Hardware Configuration"

	choice FLXOS_DEVICE_PROFILE
		prompt "Device Profile"
		default FLXOS_PROFILE_GENERIC_ESP32
		help
			Select your hardware board. This loads metadata about display,
			touch, SD card, and connectivity for the selected board.
			Pin configuration is still handled by the options below.

		config FLXOS_PROFILE_GENERIC_ESP32
			bool "Generic ESP32"
			help
				Generic ESP32 board with no specific hardware assumptions.

		config FLXOS_PROFILE_GENERIC_ESP32S3
			bool "Generic ESP32-S3"
			help
				Generic ESP32-S3 board with PSRAM and USB-OTG.

		config FLXOS_PROFILE_GENERIC_ESP32C3
			bool "Generic ESP32-C3"
			help
				Generic ESP32-C3 RISC-V board (BLE only, no classic Bluetooth).

		config FLXOS_PROFILE_CYD_2432S028R
			bool "CYD 2432S028R (2.8\" ILI9341 + XPT2046)"
			help
				Cheap Yellow Display 2.8" with ILI9341 display and XPT2046
				resistive touch (original v1 variant).
	endchoice

	config FLXOS_DEVICE_PROFILE_ID
		string
		default "generic-esp32"     if FLXOS_PROFILE_GENERIC_ESP32
		default "generic-esp32s3"   if FLXOS_PROFILE_GENERIC_ESP32S3
		default "generic-esp32c3"   if FLXOS_PROFILE_GENERIC_ESP32C3
		default "cyd-2432s028r"     if FLXOS_PROFILE_CYD_2432S028R

	config FLXOS_HEADLESS_MODE
		bool "Headless Mode (No Display/GUI)"
		default n
		help
			Run FlxOS without display hardware or GUI.
			Disables LovyanGFX, LVGL, and all UI components.
			Useful for headless deployments, testing, and CI/CD.

	config FLXOS_REQUIRE_LVGL_LOVYAN
		bool
		default y
		depends on !FLXOS_HEADLESS_MODE
		select LV_USE_LOVYAN_GFX

	config FLXOS_CLI_ENABLED
		bool "Enable CLI (Command Line Interface)"
		default y
		help
			Enable interactive command-line interface via serial console.
			Provides system commands like sysinfo, heap, uptime, reboot.
			Works in both headless and GUI modes.

	if !FLXOS_HEADLESS_MODE

		config FLXOS_DISPLAY_WIDTH
			int "Display Width"
			default 240
			help
				The horizontal resolution of the display.

		config FLXOS_DISPLAY_HEIGHT
			int "Display Height"
			default 320
			help
				The vertical resolution of the display.

		config FLXOS_DISPLAY_ROTATION
			int "Display Rotation (0, 90, 180, 270)"
			range 0 270
			default 90
			help
				Initial rotation of the display in degrees.

		choice FLXOS_HARDWARE_MODE
			prompt "Hardware Initialization Mode"
			default FLXOS_HARDWARE_MANUAL
			help
				Choose between manual pin configuration or LovyanGFX AutoDetect.

			config FLXOS_HARDWARE_MANUAL
				bool "Manual Configuration"
				help
					Manually specify pins and drivers.

			config FLXOS_HARDWARE_AUTODETECT
				bool "AutoDetect (for known boards)"
				help
					Use LovyanGFX AutoDetect to find hardware at runtime.
		endchoice

		if FLXOS_HARDWARE_MANUAL
			menu "Display Driver Selection"
				choice FLXOS_DISPLAY_DRIVER
					prompt "Panel Driver"
					default FLXOS_DISPLAY_ILI9341

					config FLXOS_DISPLAY_AMOLED
						bool "AMOLED"
					config FLXOS_DISPLAY_CO5300
						bool "CO5300"
					config FLXOS_DISPLAY_GC9A01
						bool "GC9A01 (Round)"
					config FLXOS_DISPLAY_GDEW0154D67
						bool "GDEW0154D67 (E-Paper)"
					config FLXOS_DISPLAY_GDEW0154M09
						bool "GDEW0154M09 (E-Paper)"
					config FLXOS_DISPLAY_HUB75
						bool "HUB75 (LED Matrix)"
					config FLXOS_DISPLAY_ILI9163
						bool "ILI9163"
					config FLXOS_DISPLAY_ILI9225
						bool "ILI9225"
					config FLXOS_DISPLAY_ILI9341
						bool "ILI9341"
					config FLXOS_DISPLAY_ILI9342
						bool "ILI9342"
					config FLXOS_DISPLAY_ILI9481
						bool "ILI9481"
					config FLXOS_DISPLAY_ILI9486
						bool "ILI9486"
					config FLXOS_DISPLAY_ILI9488
						bool "ILI9488"
					config FLXOS_DISPLAY_ILI9806
						bool "ILI9806"
					config FLXOS_DISPLAY_IT8951
						bool "IT8951 (E-Paper Controller)"
					config FLXOS_DISPLAY_M5HDMI
						bool "M5HDMI (M5Stack)"
					config FLXOS_DISPLAY_M5UnitGLASS
						bool "M5UnitGLASS (M5Stack)"
					config FLXOS_DISPLAY_M5UnitLCD
						bool "M5UnitLCD (M5Stack)"
					config FLXOS_DISPLAY_NT35510
						bool "NT35510"
					config FLXOS_DISPLAY_NV3041A
						bool "NV3041A"
					config FLXOS_DISPLAY_R61529
						bool "R61529"
					config FLXOS_DISPLAY_RA8875
						bool "RA8875"
					config FLXOS_DISPLAY_RM67162
						bool "RM67162 (AMOLED)"
					config FLXOS_DISPLAY_RM68120
						bool "RM68120"
					config FLXOS_DISPLAY_RM690B0
						bool "RM690B0 (AMOLED)"
					config FLXOS_DISPLAY_S6D04K1
						bool "S6D04K1"
					config FLXOS_DISPLAY_SH8601Z
						bool "SH8601Z (AMOLED)"
					config FLXOS_DISPLAY_SharpLCD
						bool "Sharp Memory LCD"
					config FLXOS_DISPLAY_SSD1306
						bool "SSD1306 (OLED)"
					config FLXOS_DISPLAY_SSD1327
						bool "SSD1327 (OLED)"
					config FLXOS_DISPLAY_SSD1331
						bool "SSD1331 (OLED)"
					config FLXOS_DISPLAY_SSD1351
						bool "SSD1351 (OLED)"
					config FLXOS_DISPLAY_SSD1963
						bool "SSD1963"
					config FLXOS_DISPLAY_ST7735
						bool "ST7735"
					config FLXOS_DISPLAY_ST7789
						bool "ST7789"
					config FLXOS_DISPLAY_ST7789P3
						bool "ST7789P3"
					config FLXOS_DISPLAY_ST7796
						bool "ST7796"
					config FLXOS_DISPLAY_ST77961
						bool "ST77961"
				endchoice

				config FLXOS_DISPLAY_INVERT
					bool "Invert Display Colors"
					default n

				config FLXOS_DISPLAY_RGB_ORDER
					bool "Is RGB Order? (N=BGR)"
					default n
			endmenu

			menu "Display Bus Configuration"
				choice FLXOS_DISPLAY_BUS
					prompt "Display Bus Type"
					default FLXOS_BUS_SPI
					help
						Select the bus type for the display connection.
						Note: 16-bit Parallel is strictly for ESP32-S3.

					config FLXOS_BUS_SPI
						bool "SPI"
					config FLXOS_BUS_I2C
						bool "I2C"
					config FLXOS_BUS_PARALLEL8
						bool "8-bit Parallel"
					config FLXOS_BUS_PARALLEL16
						bool "16-bit Parallel"
				endchoice

				if FLXOS_BUS_SPI
					menu "SPI Bus Settings"
						config FLXOS_SPI_HOST
							int "SPI Host (1=SPI2/HSPI, 2=SPI3/VSPI)"
							range 1 2
							default 1
							help
								SPI Host Selection.
								ESP32: 1=HSPI, 2=VSPI.
								ESP32-S3: 1=SPI2, 2=SPI3.

						config FLXOS_SPI_MODE
							int "SPI Mode (0-3)"
							range 0 3
							default 0
							help
								SPI mode: 0 (CPOL=0,CPHA=0), 1 (CPOL=0,CPHA=1), 2 (CPOL=1,CPHA=0), 3 (CPOL=1,CPHA=1)

						config FLXOS_SPI_FREQ_WRITE
							int "SPI Write Frequency (Hz)"
							default 80000000
							help
								Default is 40MHz. Some displays support up to 80MHz.

						config FLXOS_SPI_FREQ_READ
							int "SPI Read Frequency (Hz)"
							default 40000000

						config FLXOS_SPI_3WIRE
							bool "Use 3-Wire SPI (no MISO)"
							default n

						config FLXOS_SPI_DMA_CHANNEL
							int "SPI DMA Channel (0=auto)"
							range 0 2
							default 0
							help
								0 = SPI_DMA_CH_AUTO, 1 = SPI_DMA_CH1, 2 = SPI_DMA_CH2

						config FLXOS_PIN_SCLK
							int "SPI SCLK Pin"
							range -1 48
							default 12 if IDF_TARGET_ESP32S3
							default 6 if IDF_TARGET_ESP32C3
							default 18
							help
								Clock pin. Default: S3=12, C3=6, ESP32=18 (VSPI).

						config FLXOS_PIN_MOSI
							int "SPI MOSI Pin"
							range -1 48
							default 11 if IDF_TARGET_ESP32S3
							default 7 if IDF_TARGET_ESP32C3
							default 23
							help
								Data out. Default: S3=11, C3=7, ESP32=23 (VSPI).
								WARNING: On Standard ESP32, DO NOT use GPIO 6-11 (Flash Memory).

						config FLXOS_PIN_MISO
							int "SPI MISO Pin (-1 to disable)"
							range -1 48
							default 13 if IDF_TARGET_ESP32S3
							default 2 if IDF_TARGET_ESP32C3
							default 19
							help
								Data in. Default: S3=13, C3=2, ESP32=19 (VSPI).

						config FLXOS_PIN_DC
							int "Display DC Pin"
							range -1 48
							default 9 if IDF_TARGET_ESP32S3
							default 2
					endmenu
				endif

				if FLXOS_BUS_I2C
					menu "I2C Bus Settings"
						config FLXOS_I2C_PORT
							int "I2C Port (0 or 1)"
							range 0 1
							default 0

						config FLXOS_I2C_FREQ
							int "I2C Frequency (Hz)"
							default 400000
							help
								Standard: 100000, Fast: 400000, Fast Plus: 1000000

						config FLXOS_I2C_ADDR
							hex "I2C Device Address"
							default 0x3C
							help
								Common addresses: 0x3C or 0x3D for SSD1306

						config FLXOS_PIN_I2C_SDA
							int "I2C SDA Pin"
							range -1 48
							default 21 if IDF_TARGET_ESP32
							default 8

						config FLXOS_PIN_I2C_SCL
							int "I2C SCL Pin"
							range -1 48
							default 22 if IDF_TARGET_ESP32
							default 9
					endmenu
				endif

				if FLXOS_BUS_PARALLEL8 || FLXOS_BUS_PARALLEL16
					menu "Parallel Bus Settings"
						config FLXOS_PARALLEL_FREQ
							int "Parallel Bus Frequency (Hz)"
							default 16000000

						config FLXOS_PIN_WR
							int "Write Strobe (WR) Pin"
							range -1 48
							default 4

						config FLXOS_PIN_RD
							int "Read Strobe (RD) Pin (-1 to disable)"
							range -1 48
							default -1

						config FLXOS_PIN_DC
							int "Data/Command (DC) Pin"
							range -1 48
							default 2

						config FLXOS_PIN_D0
							int "Data Pin D0"
							range -1 48
							default 15
						config FLXOS_PIN_D1
							int "Data Pin D1"
							range -1 48
							default 13
						config FLXOS_PIN_D2
							int "Data Pin D2"
							range -1 48
							default 12
						config FLXOS_PIN_D3
							int "Data Pin D3"
							range -1 48
							default 14
						config FLXOS_PIN_D4
							int "Data Pin D4"
							range -1 48
							default 27
						config FLXOS_PIN_D5
							int "Data Pin D5"
							range -1 48
							default 25
						config FLXOS_PIN_D6
							int "Data Pin D6"
							range -1 48
							default 33
						config FLXOS_PIN_D7
							int "Data Pin D7"
							range -1 48
							default 32
					endmenu
				endif

				if FLXOS_BUS_PARALLEL16
					menu "Parallel 16-bit Extended Pins"
						config FLXOS_PIN_D8
							int "Data Pin D8"
							range -1 48
							default 21
						config FLXOS_PIN_D9
							int "Data Pin D9"
							range -1 48
							default 22
						config FLXOS_PIN_D10
							int "Data Pin D10"
							range -1 48
							default 23
						config FLXOS_PIN_D11
							int "Data Pin D11"
							range -1 48
							default 19
						config FLXOS_PIN_D12
							int "Data Pin D12"
							range -1 48
							default 18
						config FLXOS_PIN_D13
							int "Data Pin D13"
							range -1 48
							default 5
						config FLXOS_PIN_D14
							int "Data Pin D14"
							range -1 48
							default 17
						config FLXOS_PIN_D15
							int "Data Pin D15"
							range -1 48
							default 16
					endmenu
				endif

				menu "Common Display Pins"
					config FLXOS_PIN_CS
						int "Display CS Pin (-1 to disable)"
						range -1 48
						default 10 if IDF_TARGET_ESP32S3
						default 7 if IDF_TARGET_ESP32C3
						default 5

					config FLXOS_PIN_RST
						int "Display Reset Pin (-1 to disable)"
						range -1 48
						default 14 if IDF_TARGET_ESP32S3
						default 15

					config FLXOS_PIN_BUSY
						int "Display Busy Pin (-1 to disable)"
						range -1 48
						default -1
				endmenu

				menu "Advanced Panel Settings"
					config FLXOS_PANEL_OFFSET_X
						int "Panel X Offset"
						default 0
						help
							Horizontal offset for displays with non-zero start position

					config FLXOS_PANEL_OFFSET_Y
						int "Panel Y Offset"
						default 0
						help
							Vertical offset for displays with non-zero start position

					config FLXOS_PANEL_OFFSET_ROTATION
						int "Panel Rotation Offset"
						range 0 7
						default 0
						help
							Additional rotation offset for panel alignment

					config FLXOS_DUMMY_READ_PIXEL
						int "Dummy Read Pixel Count"
						default 8
						help
							Number of dummy pixels to read before actual data

					config FLXOS_DUMMY_READ_BITS
						int "Dummy Read Bits"
						default 1
						help
							Number of dummy bits to read

					config FLXOS_PANEL_READABLE
						bool "Panel Supports Reading"
						default y
						help
							Enable if the panel supports reading pixel data back

					config FLXOS_PANEL_DLEN_16BIT
						bool "Use 16-bit Data Length"
						default n

					config FLXOS_BUS_SHARED
						bool "SPI Bus is Shared"
						default y
						help
							Enable if multiple devices share the same SPI bus
				endmenu

				menu "Backlight Configuration"
					config FLXOS_PIN_BCKL
						int "Backlight Pin (-1 to disable)"
						range -1 48
						default 21 if IDF_TARGET_ESP32
						default 7 if IDF_TARGET_ESP32S3
						default 17

					config FLXOS_BCKL_INVERT
						bool "Invert Backlight PWM"
						default n

					config FLXOS_BCKL_FREQ
						int "Backlight PWM Frequency (Hz)"
						default 20000

					config FLXOS_BCKL_PWM_CHANNEL
						int "Backlight PWM Channel"
						range 0 15
						default 7
				endmenu

				config FLXOS_TOUCH_ENABLED
					bool "Enable Touch"
					default y

				if FLXOS_TOUCH_ENABLED
					choice FLXOS_TOUCH_DRIVER
						prompt "Touch Driver"
						default FLXOS_TOUCH_XPT2046

						config FLXOS_TOUCH_XPT2046
							bool "XPT2046 (SPI)"
						config FLXOS_TOUCH_FT5x06
							bool "FT5x06 / FT6x36 (I2C)"
						config FLXOS_TOUCH_GT911
							bool "GT911 (I2C)"
						config FLXOS_TOUCH_CSTxxx
							bool "CSTxxx (I2C)"
						config FLXOS_TOUCH_CHSC6x
							bool "CHSC6x (I2C)"
						config FLXOS_TOUCH_GSLx680
							bool "GSLx680 (I2C)"
						config FLXOS_TOUCH_NS2009
							bool "NS2009 (I2C)"
						config FLXOS_TOUCH_RA8875
							bool "RA8875 (Integrated)"
						config FLXOS_TOUCH_STMPE610
							bool "STMPE610 (I2C)"
						config FLXOS_TOUCH_TT21xxx
							bool "TT21xxx (I2C)"
					endchoice

					menu "Touch Pin Configuration"
						config FLXOS_PIN_TOUCH_CS
							int "Touch CS Pin (SPI only)"
							range -1 48
							default 5 if IDF_TARGET_ESP32S3
							default 8
							depends on FLXOS_TOUCH_XPT2046

						config FLXOS_PIN_TOUCH_SCL
							int "Touch I2C SCL Pin"
							range -1 48
							default 22 if IDF_TARGET_ESP32
							default 9
							depends on !FLXOS_TOUCH_XPT2046 && !FLXOS_TOUCH_RA8875

						config FLXOS_PIN_TOUCH_SDA
							int "Touch I2C SDA Pin"
							range -1 48
							default 21 if IDF_TARGET_ESP32
							default 8
							depends on !FLXOS_TOUCH_XPT2046 && !FLXOS_TOUCH_RA8875

						config FLXOS_PIN_TOUCH_INT
							int "Touch INT Pin (-1 to disable)"
							range -1 48
							default 6 if IDF_TARGET_ESP32S3
							default -1
					endmenu

					menu "Touch Calibration"
						config FLXOS_TOUCH_X_MIN
							int "Touch X Minimum"
							default 3800
							help
								Minimum raw X coordinate value

						config FLXOS_TOUCH_X_MAX
							int "Touch X Maximum"
							default 200
							help
								Maximum raw X coordinate value (0 = use display width)

						config FLXOS_TOUCH_Y_MIN
							int "Touch Y Minimum"
							default 200
							help
								Minimum raw Y coordinate value

						config FLXOS_TOUCH_Y_MAX
							int "Touch Y Maximum"
							default 3800
							help
								Maximum raw Y coordinate value (0 = use display height)

						config FLXOS_TOUCH_OFFSET_ROTATION
							int "Touch Rotation Offset"
							range 0 7
							default 0
							help
								Additional rotation offset for touch alignment
					endmenu

					menu "Touch Advanced Settings"
						config FLXOS_TOUCH_SPI_FREQ
							int "Touch SPI Frequency (Hz)"
							default 1000000
							depends on FLXOS_TOUCH_XPT2046
							help
								SPI frequency for touch controller (typically 1MHz)

						config FLXOS_TOUCH_SPI_SEPARATE_PINS
							bool "Use Separate SPI Pins for Touch"
							default n
							depends on FLXOS_TOUCH_XPT2046
							help
								Enable if the touch controller uses different SPI pins
								than the display. Required for boards like the
								ESP32-2432S028R (Cheap Yellow Display / CYD) where
								the XPT2046 is on separate GPIO pins.

						if FLXOS_TOUCH_SPI_SEPARATE_PINS
							config FLXOS_TOUCH_SPI_HOST
								int "Touch SPI Host (-1=Software SPI, 1=SPI2, 2=SPI3)"
								range -1 2
								default -1
								help
									-1 = Software (bitbang) SPI. Use this when the SPI
									bus is shared with SD card and cannot be used
									simultaneously (e.g. ESP32-2432S028R).
									1 = SPI2_HOST (HSPI), 2 = SPI3_HOST (VSPI).

							config FLXOS_PIN_TOUCH_SCLK
								int "Touch SPI SCLK Pin"
								range -1 48
								default 25
								help
									SPI clock pin for the touch controller.
									Default 25 (ESP32-2432S028R).

							config FLXOS_PIN_TOUCH_MOSI
								int "Touch SPI MOSI Pin"
								range -1 48
								default 32
								help
									SPI data out pin for the touch controller.
									Default 32 (ESP32-2432S028R).

							config FLXOS_PIN_TOUCH_MISO
								int "Touch SPI MISO Pin"
								range -1 48
								default 39
								help
									SPI data in pin for the touch controller.
									Default 39 (ESP32-2432S028R).
						endif

						config FLXOS_TOUCH_I2C_PORT
							int "Touch I2C Port"
							range 0 1
							default 0
							depends on !FLXOS_TOUCH_XPT2046
							help
								I2C port number (0 or 1)

						config FLXOS_TOUCH_I2C_FREQ
							int "Touch I2C Frequency (Hz)"
							default 400000
							depends on !FLXOS_TOUCH_XPT2046
							help
								I2C frequency for touch controller (typically 400kHz)

						config FLXOS_TOUCH_BUS_SHARED
							bool "Touch Bus is Shared"
							default y
							help
								Enable if touch controller shares bus with other devices
					endmenu
				endif
			endmenu

	endif

				menu "SD Card Configuration"
				config FLXOS_SD_CARD_ENABLED
					bool "Enable SD Card Support"
					default y
					help
						Enable SD card storage via SPI bus.

				if FLXOS_SD_CARD_ENABLED
					config FLXOS_SD_MOUNT_POINT
						string "SD Card Mount Point"
						default "/sdcard"
						help
							VFS mount point for SD card.

					config FLXOS_SD_PIN_CS
						int "SD Card SPI CS Pin"
						range 0 48
						default 4 if IDF_TARGET_ESP32S3
						default 5
						help
							Chip select pin for SD card SPI.

					config FLXOS_SD_PIN_MOSI
						int "SD Card SPI MOSI Pin (-1 = use display MOSI)"
						range -1 48
						default -1
						help
							MOSI pin for SD card. Set to -1 to reuse the
							display SPI MOSI pin (CONFIG_FLXOS_PIN_MOSI).

					config FLXOS_SD_PIN_MISO
						int "SD Card SPI MISO Pin (-1 = use display MISO)"
						range -1 48
						default -1
						help
							MISO pin for SD card. Set to -1 to reuse the
							display SPI MISO pin (CONFIG_FLXOS_PIN_MISO).

					config FLXOS_SD_PIN_SCLK
						int "SD Card SPI SCLK Pin (-1 = use display SCLK)"
						range -1 48
						default -1
						help
							SCLK pin for SD card. Set to -1 to reuse the
							display SPI SCLK pin (CONFIG_FLXOS_PIN_SCLK).

					config FLXOS_SD_SPI_HOST
						int "SD Card SPI Host (1=SPI2, 2=SPI3)"
						range 1 2
						default 1
						help
							SPI host for SD card.
							1 = SPI2_HOST (HSPI), 2 = SPI3_HOST (VSPI).

					config FLXOS_SD_MAX_FREQ_KHZ
						int "SD Card Max SPI Frequency (kHz)"
						range 400 40000
						default 20000
						help
							Maximum SPI clock frequency for SD card in kHz.
							Typical values: 4000 (4MHz) or 20000 (20MHz).
				endif
			endmenu

			menu "Battery Configuration"
					config FLXOS_BATTERY_ENABLED
						bool "Enable Battery Monitoring"
						default n
						help
							Enable battery voltage monitoring via ADC.

					if FLXOS_BATTERY_ENABLED
						choice FLXOS_BATTERY_ADC_UNIT
							prompt "ADC Unit"
							default FLXOS_BATTERY_ADC_UNIT_1
							help
								Select the ADC unit to use. ADC2 is often restricted when WiFi is active.

							config FLXOS_BATTERY_ADC_UNIT_1
								bool "ADC Unit 1"
							config FLXOS_BATTERY_ADC_UNIT_2
								bool "ADC Unit 2"
						endchoice

						config FLXOS_BATTERY_ADC_CHANNEL
							int "ADC Channel"
							range 0 9
							default 7
							help
								ADC channel for battery sensing.
								Check your board documentation for GPIO to Channel mapping.

						config FLXOS_BATTERY_VOLTAGE_MAX
							int "Battery Max Voltage (mV)"
							default 4200
							help
								Voltage when battery is at 100%.

						config FLXOS_BATTERY_VOLTAGE_MIN
							int "Battery Min Voltage (mV)"
							default 3300
							help
								Voltage when battery is at 0%.

						config FLXOS_BATTERY_DIVIDER_FACTOR
							int "Voltage Divider Factor (multiplied by 100)"
							default 200
							help
								If you have a 100k/100k divider, factor is 2.0.
								Enter 200 for 2.0, 100 for no divider.
					endif
				endmenu
	endif

endmenu
